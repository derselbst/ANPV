From 89e9d04a173e418e85511a6112e1376e4b843384 Mon Sep 17 00:00:00 2001
From: derselbst <tom.mbrt@googlemail.com>
Date: Tue, 14 Jun 2022 22:31:50 +0200
Subject: [PATCH 3/3] Compile kf5configwidgets without kf5auth on Windows

---
 ports/kf5configwidgets/portfile.cmake | 5 +++++
 ports/kf5configwidgets/vcpkg.json     | 5 ++++-
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/ports/kf5configwidgets/portfile.cmake b/ports/kf5configwidgets/portfile.cmake
index b676f3863..7c3783519 100644
--- a/ports/kf5configwidgets/portfile.cmake
+++ b/ports/kf5configwidgets/portfile.cmake
@@ -15,6 +15,11 @@ vcpkg_check_features(
 # Prevent KDEClangFormat from writing to source effectively blocking parallel configure
 file(WRITE "${SOURCE_PATH}/.clang-format" "DisableFormat: true\nSortIncludes: false\n")
 
+if(VCPKG_TARGET_IS_WINDOWS)
+    set(ENV{CFLAGS} "$ENV{CFLAGS} -DKCONFIGWIDGETS_NO_KAUTH")
+    set(ENV{CXXFLAGS} "$ENV{CXXFLAGS} -DKCONFIGWIDGETS_NO_KAUTH")
+endif()
+
 vcpkg_cmake_configure(
     SOURCE_PATH "${SOURCE_PATH}"
     OPTIONS
diff --git a/ports/kf5configwidgets/vcpkg.json b/ports/kf5configwidgets/vcpkg.json
index 4ec5df88c..ec9843b8f 100644
--- a/ports/kf5configwidgets/vcpkg.json
+++ b/ports/kf5configwidgets/vcpkg.json
@@ -12,7 +12,10 @@
         "tools"
       ]
     },
-    "kf5auth",
+    {
+      "name": "kf5auth",
+      "platform": "!(windows | android)"
+    },
     "kf5codecs",
     "kf5config",
     "kf5guiaddons",
-- 
2.35.3

